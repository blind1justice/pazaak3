<div class="container">
  <div class="content">
    <h1 class="game-title">Pazaak</h1>

    <mat-card class="games-card">
      <mat-card-header>
        <mat-card-title>Open Games</mat-card-title>
        <mat-card-subtitle>
          Refreshes every 5 seconds
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        @if (isLoading()) {
          <div class="loading">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Loading games...</p>
          </div>
        }

        @else if (games().length === 0) {
          <p class="no-games">No open games right now. Create one!</p>
        }

        @else {
          <table mat-table [dataSource]="games()" class="games-table">

            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>Game ID</th>
              <td mat-cell *matCellDef="let game">#{{ game.id }}</td>
            </ng-container>

            <ng-container matColumnDef="creator">
              <th mat-header-cell *matHeaderCellDef>Your opponent</th>
              <td mat-cell *matCellDef="let game">{{ game.player1.nickname }}</td>
            </ng-container>

            <ng-container matColumnDef="bid">
              <th mat-header-cell *matHeaderCellDef>Stake</th>
              <td mat-cell *matCellDef="let game">{{ game.bid }} PZK</td>
            </ng-container>

            <ng-container matColumnDef="reward">
              <th mat-header-cell *matHeaderCellDef>Reward</th>
              <td mat-cell *matCellDef="let game">{{ game.reward }} PZK</td>
            </ng-container>

            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef>Join</th>
              <td mat-cell *matCellDef="let game">
                <button mat-raised-button color="primary"
                        [disabled]="isJoining()"
                        (click)="joinGame(game.id)">
                  @if (isJoining()) {
                    <mat-spinner diameter="20"></mat-spinner>
                  } @else {
                    Join
                  }
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        }
      </mat-card-content>
    </mat-card>

    <div class="actions">
      <button mat-raised-button color="accent" routerLink="/create-game">
        Create New Game
      </button>
      <button mat-button routerLink="/">
        Back to Menu
      </button>
    </div>
  </div>
</div>
